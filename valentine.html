<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MJ-Lab | The Magical Memory Box</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { background-color: #fff1f2; overflow-x: hidden; font-family: 'sans-serif'; }
        .float-animation { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .smooth-move { transition: all 1.0s cubic-bezier(0.19, 1, 0.22, 1); }
        .hidden-section { display: none; }
        
        /* Stacked Photos Effect */
        .photo-stack { position: relative; width: 280px; height: 320px; margin: 0 auto; }
        .stacked-photo {
            position: absolute; width: 100%; height: 100%;
            background: white; padding: 10px 10px 40px 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border: 1px solid #ffe4e6; border-radius: 12px;
            cursor: pointer; transition: transform 0.7s cubic-bezier(0.23, 1, 0.32, 1), opacity 0.6s;
            user-select: none;
        }
        .stacked-photo img { width: 100%; height: 100%; object-fit: cover; border-radius: 4px; background: #fdf2f2; }
        .photo-out { transform: translate(180%, -30%) rotate(45deg) !important; opacity: 0; pointer-events: none; }
        
        /* Message Box Shine */
        .card-shine { background: linear-gradient(135deg, #fff 0%, #fff1f2 100%); position: relative; overflow: hidden; }
        .card-shine::after { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent); transform: rotate(45deg); animation: shine 4s infinite; }
        @keyframes shine { 0% { left: -50%; } 100% { left: 150%; } }
    </style>
</head>
<body class="text-slate-800 flex items-center justify-center min-h-screen p-4">

    <div id="main-container" class="bg-white border-4 border-pink-200 p-8 md:p-12 rounded-[3.5rem] shadow-2xl max-w-lg w-full text-center relative z-50">
        
        <div id="icon-box" class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-pink-50 mb-6 float-animation">
            <span id="display-icon" class="text-4xl">üéÅ</span>
        </div>

        <div id="decoder-section">
            <h1 class="text-2xl font-black text-rose-600 uppercase mb-4 tracking-tighter">Secret Box Unlock</h1>
            <input type="text" id="passcode" placeholder="----" maxlength="4" class="bg-pink-50 border-2 border-pink-100 rounded-2xl px-6 py-3 text-center text-rose-500 text-2xl font-bold tracking-[0.5em] focus:outline-none focus:border-rose-300 w-44 mb-6 block mx-auto">
            <button onclick="checkCode()" class="bg-rose-500 text-white px-10 py-3 rounded-full font-bold hover:scale-105 transition-all shadow-lg shadow-rose-200 uppercase tracking-widest">Open</button>
        </div>

        <div id="game-section" class="hidden-section space-y-8">
            <p id="status-msg" class="text-[10px] text-pink-400 font-bold uppercase tracking-widest"></p>
            <h2 id="question-text" class="text-xl font-bold text-slate-700 min-h-[4rem] flex items-center justify-center"></h2>
            <div class="flex flex-col items-center gap-4 relative min-h-[160px]">
                <button onclick="handleYes()" class="bg-rose-500 text-white px-16 py-3 rounded-full text-lg font-bold shadow-xl z-20 active:scale-95">YES</button>
                <button id="no-btn" class="bg-white border-2 border-pink-100 text-pink-300 px-12 py-2 rounded-full text-lg smooth-move z-10">NO</button>
            </div>
        </div>

        <div id="gallery-random" class="hidden-section space-y-6">
            <h2 class="text-xl font-black text-rose-600 uppercase">The Random Moments üì∏</h2>
            <p class="text-[11px] text-pink-500 font-bold">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏ó‡∏µ‡∏•‡∏∞‡πÉ‡∏ö‡∏ô‡∏∞ (10 ‡∏£‡∏π‡∏õ)</p>
            <div id="stack-random" class="photo-stack mt-4">
                </div>
            <div class="h-8"></div>
            <button id="next-to-food" onclick="showFoodGallery()" class="hidden-section bg-rose-500 text-white px-8 py-3 rounded-full font-bold shadow-lg animate-bounce mx-auto">‡πÑ‡∏õ‡∏´‡∏°‡∏ß‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ûî</button>
        </div>

        <div id="gallery-food" class="hidden-section space-y-6">
            <h2 class="text-xl font-black text-rose-600 uppercase">Our Delicious Logic üçù</h2>
            <p class="text-[11px] text-pink-500 font-bold">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÅ‡∏ä‡∏£‡πå‡∏Å‡∏±‡∏ô (10 ‡∏£‡∏π‡∏õ)</p>
            <div id="stack-food" class="photo-stack mt-4">
                </div>
            <div class="h-8"></div>
            <button id="next-to-card" onclick="showGreetingCard()" class="hidden-section bg-rose-500 text-white px-8 py-3 rounded-full font-bold shadow-lg animate-bounce mx-auto">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏≠‡∏ß‡∏¢‡∏û‡∏£ üíå</button>
        </div>

        <div id="greeting-section" class="hidden-section space-y-6">
            <div class="card-shine border-4 border-double border-rose-200 p-8 rounded-[2.5rem] shadow-inner">
                <div class="text-3xl mb-4">üß∏üå∑‚ú®</div>
                <h3 class="text-2xl font-black text-rose-600 mb-4 font-serif">Dear My Love,</h3>
                <p class="text-sm leading-relaxed text-slate-600 italic font-medium">
                    "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ ‡∏ß‡∏±‡∏ô‡∏Ç‡∏≠‡∏á MJ-Lab ‡∏ô‡∏∞‡∏Ñ‡∏∞<br>
                    ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤ ‡∏°‡∏±‡∏ô‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏à‡∏£‡∏¥‡∏á‡πÜ<br>
                    ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏Å‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞ ‡∏£‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î!"
                </p>
                <div class="mt-6 text-rose-400 font-bold text-xs tracking-widest uppercase">Forever & Always ‚ù§Ô∏è</div>
            </div>
            <button onclick="showReplySection()" class="bg-pink-500 text-white px-10 py-3 rounded-full font-bold shadow-lg hover:bg-pink-600 transition-all">‡∏™‡πà‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏≤‡πÄ‡∏£‡∏≤‡∏ô‡∏∞ ‚úçÔ∏è</button>
        </div>

        <div id="reply-section" class="hidden-section space-y-6">
            <h3 class="text-xl font-bold text-rose-600">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡πÉ‡∏à‡∏ö‡∏≠‡∏Å MJ ‡∏´‡∏ô‡πà‡∏≠‡∏¢...</h3>
            <textarea id="reply-msg" rows="4" class="w-full bg-pink-50 border-2 border-pink-100 rounded-2xl p-4 text-slate-700 focus:outline-none focus:border-rose-300 shadow-inner" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞..."></textarea>
            <button onclick="sendLineReply()" class="bg-[#00B900] text-white px-10 py-3 rounded-full font-bold shadow-xl flex items-center justify-center gap-2 mx-auto active:scale-95 transition-transform">
                ‡∏™‡πà‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô LINE ‚ûî
            </button>
        </div>

        <div id="final-section" class="hidden-section space-y-4">
            <h1 class="text-4xl font-black text-rose-600 tracking-tighter">HAPPY VALENTINE!</h1>
            <p class="text-pink-400 font-bold text-sm tracking-[0.4em]">MISSION SUCCESS WITH LOVE</p>
            <div class="text-7xl mt-6">ü•∞üå∑üíñ</div>
        </div>

    </div>

    <script>
        const questions = [
            "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡∏Ñ‡∏∞?",
            "‡∏Ñ‡∏∏‡∏ì‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏´‡∏±‡∏ß‡πÉ‡∏à (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Logic) ‡πÑ‡∏´‡∏°?",
            "‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö Lab ‡∏ó‡∏µ‡πà MJ ‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤?",
            "‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏£‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≠‡∏ô‡∏à‡∏ö ‡∏à‡∏∞‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô‡πÑ‡∏´‡∏°‡∏ô‡∏∞?",
            "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡∏â‡∏•‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?",
            "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÉ‡∏à‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?",
            "‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß... ‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?",
            "‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î... Will you be my Valentine?"
        ];
        let currentStep = 0;

        function checkCode() {
            if (document.getElementById('passcode').value === '1402') {
                document.getElementById('decoder-section').classList.add('hidden-section');
                document.getElementById('game-section').classList.remove('hidden-section');
                updateQuestion();
            } else { alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î‡∏ô‡πâ‡∏≤ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏∞!"); }
        }

        function updateQuestion() {
            if (currentStep < questions.length) {
                document.getElementById('status-msg').innerText = `STEP ${currentStep + 1} / 8`;
                document.getElementById('question-text').innerText = questions[currentStep];
                resetNoBtn();
            } else {
                document.getElementById('game-section').classList.add('hidden-section');
                document.getElementById('gallery-random').classList.remove('hidden-section');
                document.getElementById('display-icon').innerText = 'üì∏';
                generateStack('random', 10);
            }
        }

        function handleYes() {
            confetti({ particleCount: 30, spread: 50, origin: { y: 0.7 }, colors: ['#fb7185', '#ffffff'] });
            currentStep++; updateQuestion();
        }

        function resetNoBtn() {
            const noBtn = document.getElementById('no-btn');
            noBtn.style.position = "static"; noBtn.style.transform = "none";
        }

        const noBtn = document.getElementById('no-btn');
        noBtn.addEventListener('mouseover', () => {
            noBtn.style.position = "fixed";
            const x = Math.random() * (window.innerWidth - 150);
            const y = Math.random() * (window.innerHeight - 80);
            noBtn.style.left = '0px'; noBtn.style.top = '0px';
            noBtn.style.transform = `translate(${x}px, ${y}px)`;
        });

        function generateStack(type, count) {
            const container = document.getElementById(type === 'random' ? 'stack-random' : 'stack-food');
            let remaining = count;
            for(let i = 0; i < count; i++) {
                const div = document.createElement('div');
                div.className = 'stacked-photo';
                div.style.transform = `rotate(${(Math.random() - 0.5) * 15}deg)`;
                div.style.zIndex = count - i;
                // ‡πÉ‡∏™‡πà‡∏£‡∏π‡∏õ placeholder ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á
                div.innerHTML = `<img src="${type}${i+1}.jpg" onerror="this.src='https://via.placeholder.com/300x400/fff1f2/e11d48?text=${type}+${i+1}'">`;
                
                div.onclick = function() {
                    this.classList.add('photo-out');
                    remaining--;
                    if(remaining === 0) {
                        document.getElementById(type === 'random' ? 'next-to-food' : 'next-to-card').style.display = 'block';
                    }
                };
                container.appendChild(div);
            }
        }

        function showFoodGallery() {
            document.getElementById('gallery-random').classList.add('hidden-section');
            document.getElementById('gallery-food').classList.remove('hidden-section');
            document.getElementById('display-icon').innerText = 'üçù';
            generateStack('food', 10);
        }

        function showGreetingCard() {
            document.getElementById('gallery-food').classList.add('hidden-section');
            document.getElementById('greeting-section').classList.remove('hidden-section');
            document.getElementById('display-icon').innerText = 'üíå';
        }

        function showReplySection() {
            document.getElementById('greeting-section').classList.add('hidden-section');
            document.getElementById('reply-section').classList.remove('hidden-section');
            document.getElementById('display-icon').innerText = '‚úçÔ∏è';
        }

        function sendLineReply() {
            const msg = document.getElementById('reply-msg').value;
            if(!msg) { alert("‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ô‡πâ‡∏≤ MJ ‡∏£‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡πà‡∏∞"); return; }
            
            // ‡πÉ‡∏ä‡πâ LINE URL Scheme ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            const lineLink = `https://line.me/R/msg/text/?${encodeURIComponent("üíå ‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö: " + msg)}`;
            
            // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ LINE
            window.location.href = lineLink;
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Finale
            setTimeout(() => {
                document.getElementById('reply-section').classList.add('hidden-section');
                document.getElementById('final-section').classList.remove('hidden-section');
                document.getElementById('display-icon').innerText = 'ü•≥';
                startGrandFinale();
            }, 1000);
        }

        function startGrandFinale() {
            const end = Date.now() + 15000;
            const colors = ['#ff0000', '#fb7185', '#ffffff', '#ffd1dc'];
            (function frame() {
                confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0, y: 0.8 }, colors: colors });
                confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1, y: 0.8 }, colors: colors });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }
    </script>
</body>
</html>
